<form [formGroup]="_frm" class="container p-relative" novalidate>
    <div class="p-absolute t-5 r-5">
        <button mat-icon-button mat-dialog-close style="z-index: 9;" [matTooltipPosition]="'left'" matTooltip="Đóng">
            <mat-icon>close</mat-icon>
        </button>
    </div>
    <mat-tab-group>
        <mat-tab>
            <ng-template mat-tab-label>
                {{_isNew ? l("CreateNew") : l("Edit")}} {{ll("DoctorTitle")}}
            </ng-template>
            <div class="pt-4">
                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorName")}}</mat-label>
                            <input (input)="fullNameInput($event)" formControlName="fullName" matInput [required]="true"
                                maxlength="255">
                            <validation matSuffix [control]="_frm.controls['fullName']"></validation>
                        </mat-form-field>
                    </div>
                    <div class="col-md-4 class-icon">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorBirthDay")}}</mat-label>
                            <input mask="0*" (dateChange)="birthDayChange($event)" [max]="maxDate" matInput
                                [matDatepicker]="picker" #birthDayPicker maxlength="10">
                            <mat-datepicker-toggle matSuffix [for]="picker" class="t-2"></mat-datepicker-toggle>
                            <mat-datepicker #picker [startAt]="_birthDay"></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row pb-2">
                    <div class="col-md-6">
                        <mat-radio-group formControlName="gender" appearance="outline" class="w-100">
                            <mat-radio-button [checked]="_obj.gender==1" value="1" color="primary" class="ml-3">
                                {{l('Male')}}</mat-radio-button>
                            <mat-radio-button [checked]="_obj.gender==2" value="2" color="primary" class="ml-3">
                                {{l('Female')}}</mat-radio-button>
                        </mat-radio-group>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("Province")}}</mat-label>
                            <mat-select formControlName="provinceCode" (selectionChange)="provinceChange($event)">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let p of provinces" [value]="p.provinceCode">{{p.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("District")}}</mat-label>
                            <mat-select formControlName="districtCode">
                                <mat-option *ngIf="checkProvince" class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let d of districts" [value]="d.districtCode">{{d.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("Address")}}</mat-label>
                            <input formControlName="address" matInput maxlength="255">
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("PhoneNumber")}}</mat-label>
                            <input formControlName="phoneNumber" (input)="rulePhoneNumber()" matInput minlength="10"
                                maxlength="12">
                            <validation matSuffix [control]="_frm.controls['phoneNumber']"></validation>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("Email")}}</mat-label>
                            <input formControlName="email" matInput maxlength="255">
                            <validation matSuffix [control]="_frm.controls['email']"></validation>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorCertificationCode")}}</mat-label>
                            <input formControlName="certificationCode" matInput maxlength="45"
                                (input)="certificationCodeChange($event)">
                        </mat-form-field>
                    </div>
                    <div class="col-md-4">
                        <mat-form-field appearance="outline" class="w-100" [ngClass]="{'disabled': flagDate}">
                            <mat-label>{{l("DoctorCertificationDate")}}</mat-label>
                            <input [disabled]="_certificationInputCheck" #certificationDatePicker
                                (dateChange)="certificationDateChange($event.value)" matInput
                                [matDatepicker]="certificationDatePicker" matInput mask="0*" maxlength="10">
                            <mat-datepicker-toggle [disabled]="_certificationInputCheck" matSuffix
                                [for]="certificationDatePicker" class="t-2">
                            </mat-datepicker-toggle>
                            <mat-datepicker #certificationDatePicker [startAt]="startDate">
                            </mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorTitleCode")}}</mat-label>
                            <mat-select formControlName="titleCode">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let t of titles" [value]="t.code">{{t.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>

                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorPosition")}}</mat-label>
                            <mat-select formControlName="positionCode">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let p of positions" [value]="p.code">{{p.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorAcademic")}}</mat-label>
                            <mat-select formControlName="academicId">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let a of academics" [value]="a.id">{{a.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorDegree")}}</mat-label>
                            <mat-select formControlName="degreeId">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let d of degrees" [value]="d.id">{{d.name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorNation")}}</mat-label>
                            <mat-select formControlName="nationCode">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let n of nations" [value]="n.nationCode">{{n.nationName}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorEthnicity")}}</mat-label>
                            <mat-select formControlName="ethnicityCode">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let e of ethnicities" [value]="e.ethnicityCode">{{e.name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <!-- <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l('DoctorSpecialist')}}</mat-label>
                            <input [required]="true" matInput [formControl]="specialistCodeControl"
                                (click)="clickSpecialistCbo()" [matAutocomplete]="autoSpecialist">
                            <mat-autocomplete #autoSpecialist="matAutocomplete" [displayWith]="displaySpecialistFn"
                                (optionSelected)='onSelectSpecialist($event.option.value)'>
                                <mat-option *ngFor="let o of filteredSpecialistOptions | async" [value]="o">
                                    {{o.code + ' - ' + o.name}}
                                </mat-option>
                            </mat-autocomplete>

                        </mat-form-field> -->

                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l('DoctorSpecialist')}}</mat-label>
                            <mat-chip-list #specialChipList [required]="true">
                                <mat-chip *ngFor="let o of _specialistChip" [selectable]="specialSelectable"
                                    [removable]="specialRemovable" (removed)="specialRemove(o.code)">
                                    {{o.name}}
                                    <mat-icon matChipRemove *ngIf="specialRemovable">cancel</mat-icon>
                                </mat-chip>
                                <input matInput #specialistInput [formControl]="specialistCodeControl"
                                    [matAutocomplete]="autoSpecialist" [matChipInputFor]="specialChipList"
                                    [matChipInputSeparatorKeyCodes]="specialSeparatorKeysCodes"
                                    [matChipInputAddOnBlur]="specialAddOnBlur"
                                    (matChipInputTokenEnd)="specialAdd($event)" (input)="specialInput()"
                                    [required]="true">
                            </mat-chip-list>
                            <mat-autocomplete matInput #autoSpecialist="matAutocomplete"
                                (optionSelected)="specialSelected($event)">
                                <mat-option *ngIf="specialIsLoading" class="is-loading">
                                    <mat-spinner diameter="30"></mat-spinner>
                                </mat-option>
                                <mat-option *ngFor="let o of _specialist" [value]="o">
                                    {{o.code +' - '+o.name}}
                                </mat-option>
                            </mat-autocomplete>
                            <validation *ngIf="!checkSpecial" matSuffix [control]="specialistCodeControl"></validation>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("EducationCountryCode")}}</mat-label>
                            <mat-select formControlName="educationCountryCode">
                                <mat-option class="text-center">{{l('CancelSelect')}}</mat-option>
                                <mat-option *ngFor="let n of nations" [value]="n.nationCode">{{n.nationName}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row pb-3">
                    <div class="col-md-3 ml-3">
                        <img style="padding: 5px"
                            [src]="_avatars[0] || 'https://cmkt-image-prd.global.ssl.fastly.net/0.1.0/ps/1441527/1160/772/m1/fpnw/wm0/businessman-avatar-icon-01-.jpg?1468234792&s=e3a468692e15e93a2056bd848193e97a'"
                            height="175px" width="200px">
                    </div>
                    <div class="col-md-4">
                        <div class="col-md-3 btn btn-primary">
                            <br>
                            <div class="upload-button">
                                <input type="file" accept="image/*" multiple (change)="detectFiles($event)"><span
                                    class="btn btn-sm btn-primary-inverted">
                                    <i class="fa fa-paperclip" aria-hidden="true"></i>Tải
                                    lên
                                </span>
                            </div>
                        </div>
                        <div class="pl-3">
                            {{_avatarError}}<span>&nbsp;</span>
                            <!--<br>
                            <mat-label>Ảnh định dạng png, jpg, jpeg</mat-label>
                            <br>
                            <mat-label>Dung lượng ảnh không quá 2Mb</mat-label>-->
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-12">
                        <mat-label><b>{{l('DoctorSummary')}}</b></mat-label>
                        <ckeditor formControlName="summary" [editor]="Editor" (ready)="onReady($event)">
                        </ckeditor>
                    </div>
                </div>

                <div class="row pt-4">
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorPriceFrom")}}</mat-label>
                            <input mask="dot_separator" maxlength="14" formControlName="priceFrom" matInput>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorPriceTo")}}</mat-label>
                            <input mask="dot_separator" maxlength="14" formControlName="priceTo" matInput>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorPriceDescription")}}</mat-label>
                            <input formControlName="priceDescription" matInput maxlength="255">
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l("DoctorDescription")}}</mat-label>
                            <input formControlName="description" matInput maxlength="255" ngDefaultControl>
                        </mat-form-field>

                    </div>
                </div>

                <div class="row">

                    <!-- <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l('HealthFacilities')}}</mat-label>
                            <input matInput [formControl]="healthfacilitiesControl" (click)="clickCbo()"
                                (input)="onInputHealthfacilities()" [matAutocomplete]="auto">
                            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn"
                                (optionSelected)='onSelectHealthFacilities($event.option.value)'>
                                <mat-option *ngFor="let o of filteredHealthFacilitiesOptions | async" [value]="o">
                                    {{o.code + ' - ' + o.name}}
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field> -->
                    <div class="col-md-12" [hidden]="this.appSession.user.healthFacilitiesId">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l('HealthFacilities')}}</mat-label>
                            <mat-chip-list #chipList>
                                <mat-chip *ngFor="let o of _healthfacilitiesChip" [selectable]="selectable"
                                    [removable]="removable" (removed)="remove(o.code)">
                                    {{o.name}}
                                    <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                                </mat-chip>
                                <input matInput #healthfacilitiesInput [formControl]="healthfacilitiesControl"
                                    [matAutocomplete]="auto" [matChipInputFor]="chipList"
                                    [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                    [matChipInputAddOnBlur]="addOnBlur" (matChipInputTokenEnd)="add($event)"
                                    (input)="healthInput()">
                            </mat-chip-list>
                            <mat-autocomplete matInput #auto="matAutocomplete" (optionSelected)="selected($event)">
                                <mat-option *ngIf="isLoading" class="is-loading">
                                    <mat-spinner diameter="30"></mat-spinner>
                                </mat-option>
                                <mat-option *ngFor="let o of _healthfacilities" [value]="o">
                                    {{o.code + ' - ' + o.name}}
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                    </div>
                    <div class="col-md-12 disabled" [hidden]="!this.appSession.user.healthFacilitiesId">
                        <mat-form-field appearance="outline" class="w-100">
                            <mat-label>{{l('HealthFacilities')}}</mat-label>
                            <mat-select formControlName="healthfacilities">
                                <mat-option *ngFor="let o of _healthfacilities" [value]="o.healthFacilitiesId">
                                    {{ o.name }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-checkbox formControlName="allowBooking" (click)="checkBoxChange('allowBooking')"
                            class="pl-3" color="primary">
                            {{l('DoctorAllowBooking')}}</mat-checkbox>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-checkbox formControlName="allowFilter" (click)="checkBoxChange('allowFilter')" class="pl-3"
                            color="primary">
                            {{l('DoctorAllowFilter')}}</mat-checkbox>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <mat-checkbox formControlName="allowSearch" (click)="checkBoxChange('allowSearch')" class="pl-3"
                            color="primary">
                            {{l('DoctorAllowSearch')}}</mat-checkbox>
                    </div>
                </div>

                <div class="text-right mb-3">
                    <div *ngIf="_isNew" class="mb-2 mr-3">
                        <mat-checkbox #continueAdd (click)="checkBoxChange()" color="primary">{{l('DoctorContinueAdd')}}
                        </mat-checkbox>
                    </div>
                    <button class="mr-3" mat-button mat-dialog-close>{{l("Close")}}</button>
                    <button [disabled]="_frm.invalid" mat-raised-button color="primary"
                        (click)="submit()">{{l("Save")}}</button>
                </div>
            </div>
        </mat-tab>
    </mat-tab-group>
</form>
